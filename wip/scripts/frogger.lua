-- title:  frogger
-- author: TheWatermelon
-- desc:   clone of frogger
-- script: lua

mode="menu"

function init()
	t=0
	grid=16
	wonFrogs={}
	turtles={}
	turtles[1]={s=263,x=-1*grid,y=1*grid,speed=0.225,dir=0}
	turtles[2]={s=263,x=3*grid,y=1*grid,speed=0.225,dir=0}
	turtles[3]={s=263,x=7*grid,y=1*grid,speed=0.225,dir=0}
	turtles[4]={s=263,x=11*grid,y=1*grid,speed=0.225,dir=0}
	turtles[5]={s=263,x=14*grid,y=2*grid,speed=-0.225,dir=2}
	turtles[6]={s=263,x=7*grid,y=2*grid,speed=-0.225,dir=2}
	turtles[7]={s=263,x=7*grid,y=3*grid,speed=0.225,dir=0}
	cars={}
	cars[1]={s=259,x=4*grid,y=5*grid,speed=-1.2,dir=1}
	cars[2]={s=259,x=9*grid,y=5*grid,speed=-1.2,dir=1}
	cars[3]={s=259,x=14*grid,y=5*grid,speed=-1.2,dir=1}
	cars[4]={s=261,x=1*grid,y=6*grid,speed=1,dir=0}
	cars[5]={s=261,x=5*grid,y=6*grid,speed=1,dir=0}
	cars[6]={s=261,x=9*grid,y=6*grid,speed=1,dir=0}
	resetFrog()
end

--put frog back to the beginning
function resetFrog()
	frog={s=257,x=7*grid,y=7*grid,dir=0,onTurtle=nil,onLog=false,onReverseLog=false}
end

--frog collision
function frogOnObject(object)
	if ((frog.x>=object.x and frog.x<=object.x+grid)
	or (frog.x+grid>=object.x and frog.x+grid<=object.x+grid))
	and (frog.y==object.y) then
		return true
	end
	return false
end

--if frog is on a turtle
function checkTurtles()
	for i=1,#turtles do
		if frogOnObject(turtles[i]) then
			frog.onTurtle=turtles[i]
			return
		end
	end
	frog.onTurtle=nil
end

--if frog hit a car
function checkCars()
	for i=1,#cars do
		if frogOnObject(cars[i]) then
			resetFrog()
		end
	end
end

--move objects based on their speed
function moveObjects(objects)
	for i=1,#objects do
		objects[i].x=objects[i].x+objects[i].speed
		if objects[i].x<-grid and objects[i].speed<0 then
			objects[i].x=240
		elseif objects[i].x>240 and objects[i].speed>0 then
			objects[i].x=-grid
		end
	end
end

--if frog fell into water
function checkWater()
	if frog.y>=16 and frog.y<=48 and frog.onTurtle==nil then
		resetFrog()
	end
end

--if frog is on lilypad
function checkLily()
	if frog.y==0 then
		for i=1,13,3 do
			if ((frog.x>=i*grid and frog.x<=i*grid+grid)
			or (frog.x+grid>=i*grid and frog.x+grid<=i*grid+grid)) then
				return i
			end
		end
	end
	return 0
end

--save frog on lilypad
function stockFrog(i)
	wonFrogs[i]={s=frog.s,x=frog.x,y=0,dir=frog.dir}
	resetFrog()
end

--frogs on all lilypads
function checkWin()
	for i=1,13,3 do
		if wonFrogs[i]==nil then return false end
	end
	return true
end

function TIC()
	if mode=="game" then
		if btnp(0) and frog.y>0 then
			frog.dir=0 --north
			frog.y=frog.y-1*grid
			--check for last line
			lily=checkLily()
			if lily>0 then
				if wonFrogs[lily]==nil then
					stockFrog(lily)
				else
					frog.y=frog.y+1*grid
				end
			else
				if frog.y==0 then resetFrog() end
			end
		end
		if btnp(1) and frog.y<7*grid then 
			frog.dir=2 --south
			frog.y=frog.y+1*grid
		end
		if btnp(2) and frog.x>0 then 
			frog.dir=3 --west
			frog.x=frog.x-1*grid
			if frog.x<0 then frog.x=0 end
		end
		if btnp(3) and frog.x<14*grid then 
			frog.dir=1 --east
			frog.x=frog.x+1*grid
			if frog.x>14*grid then frog.x=14*grid end
		end

		cls(0)
		map(0)
		for i=1,#turtles do
			spr(turtles[i].s+(math.floor((t%60)/30))*2,turtles[i].x,turtles[i].y,1,1,0,turtles[i].dir,2,2)
		end
		for i=1,#cars do
			spr(cars[i].s,cars[i].x,cars[i].y,1,1,cars[i].dir,0,2,2)
		end
		spr(frog.s,frog.x,frog.y,1,1,0,frog.dir,2,2)
		for i=1,13,3 do
			if wonFrogs[i]~=nil then
				spr(wonFrogs[i].s,wonFrogs[i].x,wonFrogs[i].y,1,1,0,wonFrogs[i].dir,2,2)
			end
		end
		
		--print((math.floor((t%60)/30))*2,0,8*grid)
		
		checkTurtles()
		moveObjects(turtles)
		checkCars()
		moveObjects(cars)
		checkWater()
		
		if frog.onTurtle~=nil then
			if frog.x+frog.onTurtle.speed>0 and frog.x+frog.onTurtle.speed<14*grid then
				frog.x=frog.x+frog.onTurtle.speed
			end
		end

		if checkWin() then mode="win" end
	elseif mode=="menu" then
		if btn(4) then
			mode="game"
			init()
		end
		cls(0)
		print("FROGGER",6*grid,1*grid,9)
		print("PRESS (A) TO START",4.5*grid,4*grid,9)
		spr(frog.s,7*grid,2.5*grid,1,1,0,0,2,2)
	elseif mode=="win" then
		if btn(4) then
			mode="game"
			init()
		end
		cls(0)
		print("THANKS FOR PLAYING !",4*grid,50,9)
		print("PRESS (A) TO RESTART",4*grid,65,9)
		spr(frog.s,7*grid,1*grid,1,1,0,0,2,2)
	end
	t=t+1
end

init()

-- <TILES>
-- 001:4444444444444444444444444444444444444444444444444444444444444444
-- 002:3333333333333333333333333333333377337733737773777773777377777777
-- 003:7777777747774777774777474477447744444444444444444444444444444444
-- 004:7777777777777777777777777777777777777777777777777777777799999999
-- 005:9999999977777777777777777777777777777777777777777777777777777777
-- 017:dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
-- 018:d44442dd43333322333333333333333333333333333333333333333333333333
-- 019:7799997777777777777777777777777777777777777777777777777777777777
-- 020:7777777777777777777777777777777777777777777777777777777777999977
-- 033:dddddddddddddd33dddd3333ddd33333dd333333dd3336b3d33336b3d33336b3
-- 034:dddddddd3333dddd333ddddd33dddd3d33ddd33333d3333333333333b33b36b3
-- 049:d3333366d33333bbd3333333dd333333dd333333ddd33333dddd3333dddddddd
-- 050:b3366b333366bb33333333333333333d3333333d333333dd33333ddddddddddd
-- </TILES>

-- <SPRITES>
-- 001:1111111111111111111a112a11aa1ca2111a1aa2111aa222111112a211112a22
-- 002:11111111111111112211a1112ac1aa112aa1a111222aa1112221111122221111
-- 003:1111111111111bbb11111bcc1bbbcbccbbfffbccbffffbbbbffffbbbbffffbbb
-- 004:11111111bb111111bbb11111bbbcbbb1bbbbcbbbbbbbcbbbb99bbcbbb999bcbb
-- 005:ddddddddddddddddddddddddddddddddddddddddddddddddeeeeeeeedddddddd
-- 006:ddd11111ddd11111ddd00001dddfff01dddffff0dddffff0eee00000ddd09990
-- 007:1133111111133111111136661116654511165545116554441166455533365555
-- 008:1331111111331111666311115556611155546111554446114455663c45556333
-- 009:9911111933331193111366661166545511655455165544451664555433655554
-- 010:9111111133311111663111115566111155461111544461114556633c55563333
-- 017:1111222211112a22111aa2a2111a1a2a11aa11a2111a11111111111111111111
-- 018:2222111122221111222aa11122a1a1112a11aa111111a1111111111111111111
-- 019:bffffbbbbbbbbbbbbbbbbbbbbb00bbbbb0990bbb109901111100111111111111
-- 020:b999bbbbbbbbbbbbbbbbbbbbbbbb00bbbbb0990b111099011111001111111111
-- 021:dd6ddd6ddd6666ddddddddddd00ddddd09901110099011101001111111111111
-- 022:d6d0990066d00000ddd0000100d1111199011111990111110011111111111111
-- 023:1336555511664555116554441116554511166545111136661113311111331111
-- 024:455563334455663c554446115554611155566111666311111133111113311111
-- 025:1365555416645554165544451165545511665455111366663333119399111119
-- 026:555633334556633c544461115546111155661111663111113331111191111111
-- </SPRITES>

-- <MAP>
-- 000:111112221111111112221111111112221111111112221111111112221111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:111113231111111113231111111113231111111113231111111113231111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:111111111111111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:212121212121212121212121212121212121212121212121212121212121000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:505050505050505050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:414141414141414141414141414141414141414141414141414141414141000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:313131313131313131313131313131313131313131313131313131313131000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:404040404040404040404040404040404040404040404040404040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:303030303030303030303030303030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <PALETTE>
-- 000:140c1c44243462bd18346524854c30b27904e2c6817571617d7d7ddeeed68ddd00ff5300ff72006dc2ca81aee2504028
-- </PALETTE>

